{
  "scriptProgram": {
    "if": [
      {"===": [{"var": "method"}, "initialize"]},
      {
        "_state": {
          "board": [null, null, null, null, null, null, null, null, null],
          "currentTurn": "X",
          "moveCount": 0,
          "status": "InProgress",
          "playerX": {"var": "args.playerX"},
          "playerO": {"var": "args.playerO"},
          "gameId": {"var": "args.gameId"},
          "moveHistory": [],
          "winner": null,
          "cancelledBy": null,
          "cancelReason": null
        },
        "_result": {
          "status": "initialized",
          "board": [null, null, null, null, null, null, null, null, null]
        }
      },

      {"===": [{"var": "method"}, "makeMove"]},
      {
        "if": [
          {"!==": [{"var": "state.status"}, "InProgress"]},
          {"_result": {"valid": false, "error": "Game is not in progress"}},
          {"if": [
            {"!==": [{"var": "args.player"}, {"var": "state.currentTurn"}]},
            {"_result": {"valid": false, "error": "Not your turn"}},
            {"if": [
              {"or": [{"<": [{"var": "args.cell"}, 0]}, {">": [{"var": "args.cell"}, 8]}]},
              {"_result": {"valid": false, "error": "Cell out of bounds"}},
              {"if": [
                {"!!": [{"var": {"cat": ["state.board.", {"var": "args.cell"}]}}]},
                {"_result": {"valid": false, "error": "Cell already occupied"}},
                {
                  "_state": {
                    "board": {
                      "merge": [
                        {"slice": [{"var": "state.board"}, 0, {"var": "args.cell"}]},
                        [{"var": "args.player"}],
                        {"slice": [{"var": "state.board"}, {"+": [{"var": "args.cell"}, 1]}]}
                      ]
                    },
                    "moveCount": {"+": [{"var": "state.moveCount"}, 1]},
                    "currentTurn": {"if": [{"===": [{"var": "args.player"}, "X"]}, "O", "X"]},
                    "moveHistory": {
                      "merge": [
                        {"var": "state.moveHistory"},
                        [{"player": {"var": "args.player"}, "cell": {"var": "args.cell"}}]
                      ]
                    },
                    "status": {
                      "if": [
                        {
                          "or": [
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 0]}, {"var": "args.player"}, {"var": "state.board.0"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 1]}, {"var": "args.player"}, {"var": "state.board.1"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 2]}, {"var": "args.player"}, {"var": "state.board.2"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 3]}, {"var": "args.player"}, {"var": "state.board.3"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 4]}, {"var": "args.player"}, {"var": "state.board.4"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 5]}, {"var": "args.player"}, {"var": "state.board.5"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 6]}, {"var": "args.player"}, {"var": "state.board.6"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 7]}, {"var": "args.player"}, {"var": "state.board.7"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 8]}, {"var": "args.player"}, {"var": "state.board.8"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 0]}, {"var": "args.player"}, {"var": "state.board.0"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 3]}, {"var": "args.player"}, {"var": "state.board.3"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 6]}, {"var": "args.player"}, {"var": "state.board.6"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 1]}, {"var": "args.player"}, {"var": "state.board.1"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 4]}, {"var": "args.player"}, {"var": "state.board.4"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 7]}, {"var": "args.player"}, {"var": "state.board.7"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 2]}, {"var": "args.player"}, {"var": "state.board.2"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 5]}, {"var": "args.player"}, {"var": "state.board.5"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 8]}, {"var": "args.player"}, {"var": "state.board.8"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 0]}, {"var": "args.player"}, {"var": "state.board.0"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 4]}, {"var": "args.player"}, {"var": "state.board.4"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 8]}, {"var": "args.player"}, {"var": "state.board.8"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 2]}, {"var": "args.player"}, {"var": "state.board.2"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 4]}, {"var": "args.player"}, {"var": "state.board.4"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 6]}, {"var": "args.player"}, {"var": "state.board.6"}]}, {"var": "args.player"}]}
                            ]}
                          ]
                        },
                        "Won",
                        {
                          "if": [
                            {"===": [{"+": [{"var": "state.moveCount"}, 1]}, 9]},
                            "Draw",
                            "InProgress"
                          ]
                        }
                      ]
                    },
                    "winner": {
                      "if": [
                        {
                          "or": [
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 0]}, {"var": "args.player"}, {"var": "state.board.0"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 1]}, {"var": "args.player"}, {"var": "state.board.1"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 2]}, {"var": "args.player"}, {"var": "state.board.2"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 3]}, {"var": "args.player"}, {"var": "state.board.3"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 4]}, {"var": "args.player"}, {"var": "state.board.4"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 5]}, {"var": "args.player"}, {"var": "state.board.5"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 6]}, {"var": "args.player"}, {"var": "state.board.6"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 7]}, {"var": "args.player"}, {"var": "state.board.7"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 8]}, {"var": "args.player"}, {"var": "state.board.8"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 0]}, {"var": "args.player"}, {"var": "state.board.0"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 3]}, {"var": "args.player"}, {"var": "state.board.3"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 6]}, {"var": "args.player"}, {"var": "state.board.6"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 1]}, {"var": "args.player"}, {"var": "state.board.1"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 4]}, {"var": "args.player"}, {"var": "state.board.4"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 7]}, {"var": "args.player"}, {"var": "state.board.7"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 2]}, {"var": "args.player"}, {"var": "state.board.2"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 5]}, {"var": "args.player"}, {"var": "state.board.5"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 8]}, {"var": "args.player"}, {"var": "state.board.8"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 0]}, {"var": "args.player"}, {"var": "state.board.0"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 4]}, {"var": "args.player"}, {"var": "state.board.4"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 8]}, {"var": "args.player"}, {"var": "state.board.8"}]}, {"var": "args.player"}]}
                            ]},
                            {"and": [
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 2]}, {"var": "args.player"}, {"var": "state.board.2"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 4]}, {"var": "args.player"}, {"var": "state.board.4"}]}, {"var": "args.player"}]},
                              {"===": [{"if": [{"===": [{"var": "args.cell"}, 6]}, {"var": "args.player"}, {"var": "state.board.6"}]}, {"var": "args.player"}]}
                            ]}
                          ]
                        },
                        {"var": "args.player"},
                        null
                      ]
                    },
                    "playerX": {"var": "state.playerX"},
                    "playerO": {"var": "state.playerO"},
                    "gameId": {"var": "state.gameId"},
                    "cancelledBy": null,
                    "cancelReason": null
                  },
                  "_result": {
                    "valid": true,
                    "status": {"var": "_state.status"},
                    "winner": {"var": "_state.winner"}
                  }
                }
              ]}
            ]}
          ]}
        ]
      },

      {"===": [{"var": "method"}, "checkWinner"]},
      {
        "_result": {
          "status": {"var": "state.status"},
          "winner": {"var": "state.winner"}
        }
      },

      {"===": [{"var": "method"}, "getBoard"]},
      {
        "_result": {
          "board": {"var": "state.board"},
          "currentTurn": {"var": "state.currentTurn"},
          "moveCount": {"var": "state.moveCount"}
        }
      },

      {"===": [{"var": "method"}, "resetGame"]},
      {
        "_state": {
          "board": [null, null, null, null, null, null, null, null, null],
          "currentTurn": "X",
          "moveCount": 0,
          "status": "InProgress",
          "playerX": {"var": "state.playerX"},
          "playerO": {"var": "state.playerO"},
          "gameId": {"var": "state.gameId"},
          "moveHistory": [],
          "winner": null,
          "cancelledBy": null,
          "cancelReason": null
        },
        "_result": {
          "status": "reset",
          "board": [null, null, null, null, null, null, null, null, null],
          "message": "Board reset for new round"
        }
      },

      {"===": [{"var": "method"}, "cancelGame"]},
      {
        "_state": {
          "merge": [
            {"var": "state"},
            {
              "status": "Cancelled",
              "cancelledBy": {"var": "args.requestedBy"},
              "cancelReason": {"var": "args.reason"}
            }
          ]
        },
        "_result": {
          "status": "Cancelled",
          "message": "Game cancelled"
        }
      },

      {"_result": {"error": "Unknown method"}}
    ]
  },
  "initialState": {
    "board": [null, null, null, null, null, null, null, null, null],
    "currentTurn": "X",
    "moveCount": 0,
    "status": "NotInitialized",
    "playerX": null,
    "playerO": null,
    "gameId": null,
    "moveHistory": [],
    "winner": null,
    "cancelledBy": null,
    "cancelReason": null
  },
  "accessControl": {
    "Public": {}
  }
}