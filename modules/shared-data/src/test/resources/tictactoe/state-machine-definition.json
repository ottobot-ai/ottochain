{
  "states": {
    "setup": {
      "id": {"value": "setup"},
      "isFinal": false,
      "metadata": null
    },
    "playing": {
      "id": {"value": "playing"},
      "isFinal": false,
      "metadata": null
    },
    "finished": {
      "id": {"value": "finished"},
      "isFinal": true,
      "metadata": null
    },
    "cancelled": {
      "id": {"value": "cancelled"},
      "isFinal": true,
      "metadata": null
    }
  },
  "initialState": {"value": "setup"},
  "transitions": [
    {
      "from": {"value": "setup"},
      "to": {"value": "playing"},
      "eventName": "start_game",
      "guard": {
        "and": [
          {"!!": [{"var": "event.playerX"}]},
          {"!!": [{"var": "event.playerO"}]},
          {"!!": [{"var": "event.gameId"}]}
        ]
      },
      "effect": {
        "_oracleCall": {
          "fiberId": {"var": "state.oracleFiberId"},
          "method": "initialize",
          "args": {
            "playerX": {"var": "event.playerX"},
            "playerO": {"var": "event.playerO"},
            "gameId": {"var": "event.gameId"}
          }
        },
        "gameId": {"var": "event.gameId"},
        "playerX": {"var": "event.playerX"},
        "playerO": {"var": "event.playerO"},
        "status": "initialized"
      },
      "dependencies": []
    },
    {
      "from": {"value": "playing"},
      "to": {"value": "playing"},
      "eventName": "make_move",
      "guard": {
        "===": [{"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.status"}, "InProgress"]
      },
      "effect": {
        "_oracleCall": {
          "fiberId": {"var": "state.oracleFiberId"},
          "method": "makeMove",
          "args": {
            "player": {"var": "event.player"},
            "cell": {"var": "event.cell"}
          }
        },
        "lastMove": {
          "player": {"var": "event.player"},
          "cell": {"var": "event.cell"}
        }
      },
      "dependencies": ["11111111-1111-1111-1111-111111111111"]
    },
    {
      "from": {"value": "playing"},
      "to": {"value": "finished"},
      "eventName": "make_move",
      "guard": {
        "or": [
          {"===": [{"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.status"}, "Won"]},
          {"===": [{"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.status"}, "Draw"]}
        ]
      },
      "effect": {
        "_oracleCall": {
          "fiberId": {"var": "state.oracleFiberId"},
          "method": "makeMove",
          "args": {
            "player": {"var": "event.player"},
            "cell": {"var": "event.cell"}
          }
        },
        "finalStatus": {"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.status"},
        "winner": {"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.winner"},
        "finalBoard": {"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.board"},
        "_emit": [
          {
            "name": "game_completed",
            "data": {
              "gameId": {"var": "state.gameId"},
              "winner": {"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.winner"},
              "status": {"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.status"},
              "moveCount": {"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.moveCount"}
            }
          }
        ]
      },
      "dependencies": ["11111111-1111-1111-1111-111111111111"]
    },
    {
      "from": {"value": "playing"},
      "to": {"value": "playing"},
      "eventName": "reset_board",
      "guard": {
        "or": [
          {"===": [{"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.status"}, "Won"]},
          {"===": [{"var": "scriptOracles.11111111-1111-1111-1111-111111111111.state.status"}, "Draw"]}
        ]
      },
      "effect": {
        "_oracleCall": {
          "fiberId": {"var": "state.oracleFiberId"},
          "method": "resetGame",
          "args": {}
        },
        "roundCount": {"+": [{"var": "state.roundCount"}, 1]}
      },
      "dependencies": ["11111111-1111-1111-1111-111111111111"]
    },
    {
      "from": {"value": "playing"},
      "to": {"value": "cancelled"},
      "eventName": "cancel_game",
      "guard": {"==": [1, 1]},
      "effect": {
        "_oracleCall": {
          "fiberId": {"var": "state.oracleFiberId"},
          "method": "cancelGame",
          "args": {
            "requestedBy": {"var": "event.requestedBy"},
            "reason": {"var": "event.reason"}
          }
        },
        "cancelledBy": {"var": "event.requestedBy"},
        "cancelReason": {"var": "event.reason"}
      },
      "dependencies": []
    },
    {
      "from": {"value": "setup"},
      "to": {"value": "cancelled"},
      "eventName": "cancel_game",
      "guard": {"==": [1, 1]},
      "effect": {
        "cancelledBy": {"var": "event.requestedBy"},
        "cancelReason": {"var": "event.reason"}
      },
      "dependencies": []
    }
  ],
  "metadata": {
    "name": "TicTacToeLifecycle",
    "description": "Game lifecycle orchestrator for tic-tac-toe"
  }
}
